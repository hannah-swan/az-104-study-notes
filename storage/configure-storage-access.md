# Configure access to storage

## Modules

Below are links to the relevant modules for each listed learning objective. Modules that cover multiple objectives will be listed multiple times.

- Configure Azure storage firewalls and virtual networks
  - [Configure storage accounts](https://learn.microsoft.com/en-us/training/modules/configure-storage-accounts/)
- Create and use shared access signature (SAS) tokens
  - [Configure Azure Storage security](https://learn.microsoft.com/en-us/training/modules/configure-storage-security/)
  - [Control access to Azure Storage with shared access signatures](https://learn.microsoft.com/en-us/training/modules/control-access-to-azure-storage-with-sas/)
- Configure stored access policies
  - [Control access to Azure Storage with shared access signatures](https://learn.microsoft.com/en-us/training/modules/control-access-to-azure-storage-with-sas/)
- Manage access keys
  - [Configure Azure Storage security](https://learn.microsoft.com/en-us/training/modules/configure-storage-security/)
- Configure identity-based access for Azure Files
  - [Configure Azure Files and Azure File Sync](https://learn.microsoft.com/en-us/training/modules/configure-azure-files-file-sync/)

## Relevant Exercises

- [Use shared access signatures to delegate access to Azure Storage](https://learn.microsoft.com/en-us/training/modules/control-access-to-azure-storage-with-sas/4-exercise-use-shared-access-signatures)
- [Use stored access policies to delegate access to Azure Storage](https://learn.microsoft.com/en-us/training/modules/control-access-to-azure-storage-with-sas/6-exercise-use-stored-access-policies)

## Labs

## Summary/Notes

### General

- Every object stored in Azure Storage has a unique URL, with the storage account name as the subdomain.
- Default endpoints:
  - Container service: `mystorageaccount.blob.core.windows.net`
  - Table service: `mystorageaccount.table.core.windows.net`
  - Queue service: `mystorageaccount.queue.core.windows.net`
  - File service: `mystorageaccount.file.core.windows.net`
- Object URL is created by appending location to endpoint (ex. `mycontainer/myblob`)
- Custom domains:
  - Can map a domian and subdomain to the blob endpoint or web endpoint generated by static sites feature, allowing users to access data via your domain.
  - Currently no support for HTTPS over custom domains-- implement a CDN to get around this.
  - Two config options:
    1. Direct mapping: configure a `CNAME` record pointing from a subdomain (ex. blobs.contoso.com) to storage endpoint (ex. contosoblobs.blob.core.windows.net)
    2. Intermediary Domain Mapping: applied to domain already in use in Azure.
       - Prevent downtime by using the `asverify` keyword to permit Azure to recognize custom domain without modifying DNS record for domain.
       - Create an intermediate CNAME record for `asverify.blobs.contoso.com` to `asverify.contosoblobs.blob.windows.net`, register your custom domain in Azure, and then create the `CNAME` record for the subdomain.

### Configure Azure Storage Firewalls and Virtual Networks

- In the portal, each service has required steps to configure service endpoints and restrict network access for the service.
  - Storage accounts have "Firewalls and virtual networks" settings.
  - Restrict storage account access to certain subnets of virtual networks, or public IP address ranges.
    - Subnets and Vnets must exist in the same azure region or region pair as the storage account.

### Create and Use Shared Access Signature (SAS) Tokens

### Configure Stored Access Policies

### Manage Access Keys

### Configure Identity-Based Access for Azure Files
